version: 2.1

jobs:
  aqua-scanner:
    docker:
      - image: aquasec/aqua-scanner
    steps:
      - checkout
      - run: |
          export AQUA_URL=https://api.eu-1.supply-chain.cloud.aquasec.com
          export CSPM_URL=https://eu-1.api.cloudsploit.com
          export TRIVY_RUN_AS_PLUGIN=aqua
          trivy fs --sast --reachability --scanners misconfig,vuln,secret --db-repository=registry.aquasec.com/trivy-db:2 --checks-bundle-repository=registry.aquasec.com/trivy-checks:1 --java-db-repository=registry.aquasec.com/trivy-java-db:1 .
          # trivy fs --scanners misconfig,vuln,secret .
          # To customize which severities to scan for, add the following flag: --severity UNKNOWN,LOW,MEDIUM,HIGH,CRITICAL
          # To enable SAST scanning, add: --sast
          # To enable reachability scanning, add: --reachability
          # To enable npm/dotnet/gradle non-lock file scanning, add: --package-json / --dotnet-proj / --gradle
          # For http/https proxy configuration add env vars: HTTP_PROXY/HTTPS_PROXY, CA-CRET (path to CA certificate)

workflows:
  aqua-scan:
    jobs:
      - aqua-scanner



# version: 2.1

# jobs:
  # aqua-scanner:
    # docker:
      # - image: aquasec/aqua-scanner
    # steps:
      # - checkout
      # - run: |
          # ## export GITHUB_TOKEN=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
          # # export AQUA_KEY=RyLxPZ2NhiOpdwJgq0kr6c
          # # export AQUA_SECRET=v2FxPrdAWqFnua2ZmH3JdHspgpeGdUxL12w
          # export AQUA_URL=https://api.eu-1.supply-chain.cloud.aquasec.com
          # export CSPM_URL=https://eu-1.api.cloudsploit.com
          # export TRIVY_RUN_AS_PLUGIN=aqua
          # ls -R .
          # trivy fs --scanners misconfig,vuln,secret .
          # # To customize which severities to scan for, add the following flag: --severity UNKNOWN,LOW,MEDIUM,HIGH,CRITICAL
          # # To enable SAST scanning, add: --sast
          # # To enable reachability scanning, add: --reachability
          # # To enable npm/dotnet/gradle non-lock file scanning, add: --package-json / --dotnet-proj / --gradle
          # # For http/https proxy configuration add env vars: HTTP_PROXY/HTTPS_PROXY, CA-CRET (path to CA certificate)

# workflows:
  # aqua-scan:
    # jobs:
      # - aqua-scanner
